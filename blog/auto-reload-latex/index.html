<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="/assets/favicon.png"> <title>My auto-reload setup for writing LATEX documents in VIM</title> <header> <div class=blog-name ><a href="/">Nikola Janjušević</a></div> <nav> <ul> <li><a href="/teaching">Teaching</a> <li><a href="/publications">Publications</a> <li><a href="/notes">Notes</a> <li><a href="/assets/janjusevic_cv.pdf">CV</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content > <u>Published 2020-01-03</u> <h1 id=title ><a href="#title" class=header-anchor >My auto-reload setup for writing LATEX documents in VIM</a></h1> <div class=franklin-toc ><ol><li><a href="#update_january_17th_2021">&#40;Update&#41; January 17th 2021</a><ol><li><a href="#really_setting_your_default_viewer">REALLY setting your default viewer</a><li><a href="#zathura_options">Zathura options</a></ol><li><a href="#january_3rd_2020">January 3rd 2020</a><ol><li><a href="#my_old_setup">My &#40;Old&#41; Setup:</a><li><a href="#automatic_tab-reload_in_firefox_using_xdotool">Automatic Tab-Reload in Firefox using XDOTOOL:</a><li><a href="#listening_for_file-changes_with_entr_and_my_new_setup">Listening for File-Changes with <code>entr</code> and My New Setup:</a><li><a href="#future_work_and_remarks">Future Work and Remarks:</a></ol></ol></div> <h2 id=update_january_17th_2021 ><a href="#update_january_17th_2021" class=header-anchor >&#40;Update&#41; January 17th 2021</a></h2> <p>It&#39;s a new year, and I&#39;ve been using a new workflow for writing my LATEX documents in Vim. One frustration I had with my previous set up &#40;see below&#41; was the complicated nature of having automatic reloading using Firefox as my PDF viewer. Also, sometimes I don&#39;t want to open such a power hungry app just to view a PDF. So I now use <a href="https://pwmt.org/projects/zathura/">Zathura</a>, a minimal PDF viewer with customizable keyboard shortcuts &#40;e.x. Vim key-bindings for moving around&#41; that can be continuously updated by the compiler <code>latexmk</code>,</p> <pre><code class="bash hljs">$ latexmk -pdf -pvc report.tex</code></pre>
<p>The <code>-pvc</code> option allows for continuous previewing, which compiles the tex file at each write. As you could guess, <code>-pdf</code> option compiles the file to <code>report.pdf</code>. With the continuous previewing, we want to keep <code>latexmk</code> command running. It&#39;s useful to keep it in a separate terminal &#40;don&#39;t push it to the background&#41; as it will show us any warnings and compilation errors. When these happen, we can acknowledge the error with <code>Ctrl-D</code>, which tells <code>latexmk</code> to try compile the next file write. </p>
<p>We can open the PDF file via the terminal with,</p>
<pre><code class="bash hljs">$ zathura report.pdf --fork</code></pre>
<p>The fork option allows us to close terminal. Alternatively, we can set Zathura to our default PDF viewer in our <code>~/.bashrc</code> via <code>&#36; export READER&#61;zathura</code>.</p>
<h3 id=really_setting_your_default_viewer ><a href="#really_setting_your_default_viewer" class=header-anchor >REALLY setting your default viewer</a></h3>
<p>However, not all programs look at your environment variables to open files. A more widely used option is with the <a href="https://man.archlinux.org/man/xdg-open.1"><code>xdg-open</code></a> command, which your computer will call by default when opening a file. There have been written many versions of this command. I&#39;ve found <a href="https://github.com/march-linux/mimi">mimi</a>, which seems to have most easily configurable <code>xdg-open</code> &quot;mime-types&quot;. Replace your default <code>xdg-open</code> with the one in the mimi repository &#40;or add <code>xdg-open</code> to another fold with greater precedence in your <code>&#36;PATH</code> variable&#41;. You can then make Zathura, or any other program, you default PDF viewer with the line <code>application/pdf: zathura</code> in the mimi configuration file, <code>~/.config/mimi/mime.conf</code>.</p>
<h3 id=zathura_options ><a href="#zathura_options" class=header-anchor >Zathura options</a></h3>
<p>Zathura looks for a configuration file called <code>~/.config/zathura/zathurarc</code>. I set some options like making zooming in and out easier and more:</p>
<pre><code class="plaintext hljs">map K zoom in
map J zoom out
map u scroll half-up
map d scroll half-down
map r reload
map R rotate
set selection-clipboard clipboard</code></pre>
<p>Many many more options are available and can be found in the <a href="http://manpages.ubuntu.com/manpages/trusty/man5/zathurarc.5.html"><code>zathurarc</code></a> man page.</p>
<h2 id=january_3rd_2020 ><a href="#january_3rd_2020" class=header-anchor >January 3rd 2020</a></h2>
<p>I&#39;m so happy with my current LATEX workflow that I want to share it. It is actually  quite a niche problem that it&#39;s solving because it&#39;s born out of using VIM as my  editor &#40;a command-line editor&#41; and Firefox as my PDF viewer. I enjoy VIM as its keyboard  shortcuts allow me to write without being slowed down by using a mouse. Firefox is  my PDF viewer of choice because 1. I always have it open anyway, and 2. It has a clean UI  with features I like such as a table of contents and printing. </p>
<h3 id=my_old_setup ><a href="#my_old_setup" class=header-anchor >My &#40;Old&#41; Setup:</a></h3>
<ul>
<li><p>Windowing System: X11 &#40;this becomes important for the reload script&#41;</p>

<li><p>Editor: VIM</p>

<li><p>PDF Viewer: Firefox</p>

<li><p>Compilation: <strong>MANUAL</strong>, using <code>latexmk</code></p>

</ul>
<p>Manually compiling my LATEX document to preview my work involves to following 7 lines  of keyboard strokes. It may not seem like a lot but it quickly gets annoying. </p>
<pre><code class="plaintext hljs">:w                      # write file in VIM
Ctrl-Z                  # stop VIM and put to background
latexmk -pdf report.tex # compile to pdf
Alt-Tab                 # swtich to Firefox
Ctrl-R                  # reload tab
Alt-Tab                 # switch to Terminal
fg                      # bring VIM to foreground, continue with life</code></pre>
<p>I knew there had to be a better way. My goal was to find a method of having my  computer listen for file changes in my <code>.tex</code> file and automatically compile to PDF  and reload the viewer. </p>
<h3 id=automatic_tab-reload_in_firefox_using_xdotool ><a href="#automatic_tab-reload_in_firefox_using_xdotool" class=header-anchor >Automatic Tab-Reload in Firefox using XDOTOOL:</a></h3>
<p>Sadly Firefox doesn&#39;t currently support automatic reload of a tab based on local  file change &#40;I believe it used to have a plugin for this, however, it was removed  due to security risks&#41;. A workaround for this is using <code>xdotool - a command line X11 automation tool</code>. For those of us on UNIX-based operating  systems &#40;I believe almost all of which use X11, or some variant which allows <code>xdotool</code>  to work&#41;, this lets us interact with our windows  from the command line. That means we can essentially automate our <code>Ctrl-R</code> and <code>Alt-Tab</code>  key-strokes from before. After some skimming of the man page and stackoverflow I arrived at  the following reload script that gets the job done.</p>
<p>My <code>reload</code> bash script:</p>
<pre><code class="bash hljs"><span class=hljs-meta >#!/bin/sh</span>
CURRENT_WID=$(xdotool getactivewindow)                     
WID=$(xdotool search --name <span class=hljs-string >&quot;report.pdf - Mozilla Firefox&quot;</span>)
xdotool windowactivate --<span class=hljs-built_in >sync</span> <span class=hljs-variable >$WID</span>                         
xdotool key F5                                             
xdotool windowactivate <span class=hljs-variable >$CURRENT_WID</span></code></pre>
<p>In the first two lines of the above script we get the names of the current window  &#40;our terminal emulator&#41; and the Firefox PDF window. We then switch focus to  the PDF window with <code>windowactivate</code> and use the <code>--sync</code> argument to ensure  we only run the next line after we&#39;re confirmed to be focused on the window.  We then use <code>xdotool</code> to hit the <code>F5</code> key, equivalent to hitting <code>Ctrl-R</code>.  Finally we return focus to the command line.</p>
<p>Running the script via <code>./reload</code> will reload the current tab on the Firefox  window that is viewing the file <code>report.pdf</code>. Change the filename used in the script  to your own accordingly. Don&#39;t forget to add execute permissions to the script by running <code>chmod &#43;x reload</code>. All we have left to do is figure out how to run this script  whenever our tex file is written to.</p>
<h3 id=listening_for_file-changes_with_entr_and_my_new_setup ><a href="#listening_for_file-changes_with_entr_and_my_new_setup" class=header-anchor >Listening for File-Changes with <code>entr</code> and My New Setup:</a></h3>
<p>We can then use the command line tool <a href="https://eradman.com/entrproject/"><code>entr - run arbitrary commands when a 
file changes</code></a>  to continuously listen for any file changes to <code>report.tex</code> and run our <code>reload</code> script.  The following line in bash does the trick:</p>
<pre><code class="bash hljs">$ <span class=hljs-built_in >ls</span> report.tex | entr -ps <span class=hljs-string >&#x27;latexmk -pdf report.tex; ./reload&#x27;</span></code></pre>
<p><code>ls</code> lists information about <code>report.tex</code> and is piped into <code>entr</code>  which listens for changes. The <code>-p</code> option tells <code>entr</code> to wait  until the first change is noticed. The <code>-s</code> option allows us to  give some shell commands in single-quotes, where we&#39;ve opted to  compile our tex file to pdf with <code>latexmk</code> and then run our <code>reload</code> script. You can keep this command in another terminal window or run it in the background  of your current one. I keep it running in the foreground of another TMUX pane   to the side of my VIM pane so that I can see any error messages if  they occur.</p>
<p>My new setup now consists of simply writing the above bash one-liner  at the start of each editing session, opening my draft PDF in Firefox with <code>firefox report.pdf</code>, and then saving my work in VIM with <code>:w</code> whenever I want  to update my preview. The compilation and PDF reload now happens automatically whenever  I save my tex file&#33;</p>
<h3 id=future_work_and_remarks ><a href="#future_work_and_remarks" class=header-anchor >Future Work and Remarks:</a></h3>
<ul>
<li><p>The <code>reload</code> script relies on the current tab being the PDF tab.  A better implementation would reload the tab if it was in the background.</p>

<li><p>Every time I start editing a new project I have to <em>manually</em> type in the  little <code>ls | entr</code> bash one-liner. I should really put this into a script that  just takes in a filename.</p>

<li><p>Note that the <code>entr</code> documentation mentions the use of their own <code>reload-browser</code> script. In testing it myself I found that it occasionally fails  due to the lack of the <code>--sync</code> argument in the <code>xdotool windowactivate</code> command.  It&#39;s also nice to write your own scripts so that you really understand what&#39;s going on&#33;</p>

</ul>
<div class=page-foot >
  <div class=copyright >
  <!--<a href="https://github.com/nikopj">GitHub</a> <br> -->
    &copy; <a href="https://github.com/nikopj">Nikola Janjušević</a>. Last modified: 2025-04-21. Built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> + <a href="https://julialang.org">Julia</a>.
  </div>
</div>
</div>