<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/katex/katex.min.css"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="/assets/favicon.png"> <title>Introduction to Julia by TV denoising</title> <header> <div class=blog-name ><a href="">Nikola Janjušević</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/projects">Projects</a> <li><a href="/assets/resume.pdf">Résumé</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content > <h1 id=title ><a href="#title" class=header-anchor >Introduction to Julia by TV denoising</a></h1> <p>In this post, we implement a naive version of color-image TV denoising in the Julia programming language.</p> <div class=franklin-toc ><ol><li><a href="#total_variation_color_image_denoising">Total Variation Color Image Denoising</a><li><a href="#julia_implementation">Julia Implementation</a><ol><li><a href="#julia_workflow">Julia Workflow</a><li><a href="#the_sparse_way">The Sparse Way</a><li><a href="#the_fast_fourier_transform_way">The Fast &#40;Fourier Transform&#41; Way</a><li><a href="#comparison">Comparison</a></ol></ol></div> <h2 id=total_variation_color_image_denoising ><a href="#total_variation_color_image_denoising" class=header-anchor >Total Variation Color Image Denoising</a></h2> <p>The TV-denoising model can be motivated by wanting to approximate a clean image as piecewise constant. As such, the desired image will have a sparse gradient, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∇</mi><mi mathvariant=bold >x</mi></mrow><annotation encoding="application/x-tex">\nabla \mathbf{x}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >∇</span><span class="mord mathbf">x</span></span></span></span>. We can approximate the gradient to first order by a finite difference scheme, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=normal >∇</mi><mi mathvariant=bold >x</mi><mo>≈</mo><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi></mrow><annotation encoding="application/x-tex">\nabla \mathbf{x} \approx \mathbf{D}\mathbf{x}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >∇</span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">Dx</span></span></span></span>, with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi><mo stretchy=false >)</mo><mo stretchy=false >[</mo><mi>i</mi><mo stretchy=false >]</mo><mo>=</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo stretchy=false >]</mo><mo>−</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">(\mathbf{D}\mathbf{x})[i] = \mathbf{x}[i]-\mathbf{x}[i-1]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathbf">Dx</span><span class=mclose >)</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mclose >]</span></span></span></span>.</p> <p>We then formulate the TV-denoising problem as</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi><munder><mo><mrow><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >z</mi><mi mathvariant=normal >e</mi></mrow><mtext> </mtext></mo><mi mathvariant=bold >x</mi></munder></mi><mtext> </mtext><mstyle displaystyle=false  scriptlevel=0 ><mfrac><mn>1</mn><mn>2</mn></mfrac></mstyle><mo stretchy=false >∥</mo><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold >y</mi><msubsup><mo stretchy=false >∥</mo><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mi>λ</mi><mo stretchy=false >∥</mo><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi><msub><mo stretchy=false >∥</mo><mn>1</mn></msub><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \underset{\mathbf{x}}{\mathrm{minimize}\,}\, \tfrac{1}{2}\lVert \mathbf{x}-\mathbf{y} \rVert_2^2 + \lambda \lVert \mathbf{D}\mathbf{x} \rVert_1, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.545108em;vertical-align:-0.7em;"></span><span class=mord ><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-2.4em;margin-left:0em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span><span class=mop ><span class=mord ><span class="mord mathrm">minimize</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mopen >∥</span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class=mopen >∥</span><span class="mord mathbf">Dx</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span></span></span></span></span> <p>and which we can reformulate with a constraint equation to be amenable to ADMM,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.1600em  columnalign="right center left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi><munder><mo><mrow><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >z</mi><mi mathvariant=normal >e</mi></mrow><mtext> </mtext></mo><mi mathvariant=bold >x</mi></munder></mi><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mo stretchy=false >∥</mo><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold >y</mi><msubsup><mo stretchy=false >∥</mo><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mi>λ</mi><mo stretchy=false >∥</mo><mi mathvariant=bold >z</mi><msub><mo stretchy=false >∥</mo><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mrow><mi mathvariant=normal >s</mi><mi mathvariant=normal >.</mi><mi mathvariant=normal >t</mi><mi mathvariant=normal >.</mi></mrow><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold >z</mi><mo>=</mo><mn mathvariant=bold >0</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{rcl} \underset{\mathbf{x}}{\mathrm{minimize}\,}\,&amp; \tfrac{1}{2}\lVert \mathbf{x}-\mathbf{y} \rVert_2^2 + \lambda \lVert \mathbf{z} \rVert_1 \\ \mathrm{s.t.}\, &amp; \mathbf{D}\mathbf{x} - \mathbf{z} = \mathbf{0} \end{array}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.745108em;vertical-align:-1.1225540000000003em;"></span><span class=mord ><span class=mtable ><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6225539999999998em;"><span style="top:-3.7774460000000003em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-2.4em;margin-left:0em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span><span class=mop ><span class=mord ><span class="mord mathrm">minimize</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span><span style="top:-2.237446em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathrm">s.t.</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.1225540000000003em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6225539999999998em;"><span style="top:-3.7774460000000003em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mopen >∥</span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">λ</span><span class=mopen >∥</span><span class="mord mathbf">z</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.237446em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathbf">Dx</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">z</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathbf">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.1225540000000003em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span></span></span></span></span></span></span> <p>We now derive <a href="/notes/admm_scaled/">our iterates in scaled form</a></p> <a id=eqtv_xit  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.1600em  columnalign="right center left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em ><mi mathvariant=normal >≔</mi></mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi><munder><mo><mrow><mi mathvariant=normal >a</mi><mi mathvariant=normal >r</mi><mi mathvariant=normal >g</mi><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi></mrow><mtext> </mtext></mo><mi mathvariant=bold >x</mi></munder></mi><mtext> </mtext><mo stretchy=false >(</mo><mn>1</mn><mi mathvariant=normal >/</mi><mn>2</mn><mo stretchy=false >)</mo><mo stretchy=false >∥</mo><mi mathvariant=bold >x</mi><mo>−</mo><mi mathvariant=bold >y</mi><msubsup><mo stretchy=false >∥</mo><mn>2</mn><mn>2</mn></msubsup><mo>+</mo><mo stretchy=false >(</mo><mi>ρ</mi><mi mathvariant=normal >/</mi><mn>2</mn><mo stretchy=false >)</mo><mo stretchy=false >∥</mo><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi><mo>−</mo><msup><mi mathvariant=bold >z</mi><mi>k</mi></msup><mo>+</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><msubsup><mo stretchy=false >∥</mo><mn>2</mn><mn>2</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn mathvariant=bold >0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >=</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo stretchy=false >(</mo><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mi mathvariant=bold >y</mi><mo stretchy=false >)</mo><mo>+</mo><mi>ρ</mi><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mo stretchy=false >(</mo><mi mathvariant=bold >D</mi><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><msup><mi mathvariant=bold >z</mi><mi>k</mi></msup><mo>+</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >=</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo stretchy=false >(</mo><mi>I</mi><mo>+</mo><mi>ρ</mi><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mi mathvariant=bold >D</mi><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><mi mathvariant=bold >y</mi><mo>+</mo><mi>ρ</mi><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mo stretchy=false >(</mo><msup><mi mathvariant=bold >z</mi><mi>k</mi></msup><mo>−</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo stretchy=false >)</mo><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{rcl} \mathbf{x}^{k+1} &amp;\coloneqq&amp; \underset{\mathbf{x}}{\mathrm{argmin}\,}\, (1/2)\lVert \mathbf{x}-\mathbf{y} \rVert_2^2 + (\rho/2)\lVert \mathbf{D}\mathbf{x} - \mathbf{z}^k + \mathbf{u}^k \rVert_2^2 \\ \mathbf{0} &amp;=&amp; (\mathbf{x}^{k+1}-\mathbf{y}) + \rho\mathbf{D}^\top (\mathbf{D}\mathbf{x}^{k+1} - \mathbf{z}^{k} + \mathbf{u}^k) \\ \mathbf{x}^{k+1} &amp;=&amp; (I + \rho \mathbf{D}^\top\mathbf{D})^{-1}(\mathbf{y} + \rho\mathbf{D}^\top(\mathbf{z}^k - \mathbf{u}^k)) \end{array}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:4.161764em;vertical-align:-1.830882em;"></span><span class=mord ><span class=mtable ><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.330882em;"><span style="top:-4.481774em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.7382259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathbf">0</span></span></span><span style="top:-1.5291180000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.830882em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.330882em;"><span style="top:-4.481774em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel ><span class=mrel ><span class=mop  style="position:relative;top:-0.03472em;">:</span></span><span class=mrel ><span class=mspace  style="margin-right:-0.06666666666666667em;"></span></span><span class=mrel >=</span></span></span></span><span style="top:-2.7382259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel >=</span></span></span><span style="top:-1.5291180000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel >=</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.830882em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.330882em;"><span style="top:-4.481774em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-2.20556em;margin-left:0em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">x</span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span><span class=mop ><span class=mord ><span class="mord mathrm">argmin</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.89444em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mopen >(</span><span class=mord >1/2</span><span class=mclose >)</span><span class=mopen >∥</span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class="mord mathnormal">ρ</span><span class=mord >/2</span><span class=mclose >)</span><span class=mopen >∥</span><span class="mord mathbf">Dx</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7382259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathbf">D</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-1.5291180000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord mathbf">D</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose >))</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.830882em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span></span></span></span></span></span></span> <p>The above <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >x</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.44444em;vertical-align:0em;"></span><span class="mord mathbf">x</span></span></span></span> iterate involves solving a tridiagonal system, which is fast. As the LHS of the system is static, we can store its Cholesky factor for faster subsequent solves. However, if we further employ the TV operator with <em>circular convolution</em>, the system is diagonalized in the Fourier domain as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >D</mi><mo>=</mo><msup><mi mathvariant=script >F</mi><mi mathvariant=normal >H</mi></msup><mi mathvariant=normal >Λ</mi><mi mathvariant=script >F</mi></mrow><annotation encoding="application/x-tex">\mathbf{D} = \mathcal{F}^\mathrm{H} \Lambda \mathcal{F}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">D</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">H</span></span></span></span></span></span></span></span><span class=mord >Λ</span><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span></span></span>. Our <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> update then is then,</p> <a id=eqtv_xit_fft  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi mathvariant=script >F</mi><mi mathvariant=normal >H</mi></msup><mo stretchy=false >(</mo><mi>I</mi><mo>+</mo><mi>ρ</mi><mo stretchy=false >∣</mo><mi mathvariant=normal >Λ</mi><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi mathvariant=script >F</mi><mo stretchy=false >(</mo><mi mathvariant=bold >y</mi><mo>+</mo><mi>ρ</mi><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mo stretchy=false >(</mo><msup><mi mathvariant=bold >z</mi><mi>k</mi></msup><mo>−</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo stretchy=false >)</mo><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> \mathbf{x}^{k+1} = \mathcal{F}^\mathrm{H} (I + \rho \lvert \Lambda \rvert^2)^{-1}\mathcal{F}(\mathbf{y} + \rho\mathbf{D}^\top(\mathbf{z}^k - \mathbf{u}^k)) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8991079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">H</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class=mopen >∣</span><span class=mord >Λ</span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=mopen >(</span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.149108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.149108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose >))</span></span></span></span></span> <p>In this case, we can precompute and store the diagonal Fourier coefficients, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mn>1</mn><mi mathvariant=normal >/</mi><mo stretchy=false >(</mo><mn>1</mn><mo>+</mo><mi>ρ</mi><mo stretchy=false >∣</mo><mi mathvariant=normal >Λ</mi><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">{C = 1/(1 + \rho \lvert \Lambda \rvert^2)}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.064108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord >1/</span><span class=mopen >(</span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">ρ</span><span class=mopen >∣</span><span class=mord >Λ</span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span></span>. Our <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>-update is an element-wise soft-thresholding<sup id="fnref:1"><a href="#fndef:1" class=fnref >[1]</a></sup></p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.1600em  columnalign="right center left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msup><mi mathvariant=bold >z</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em ><mi mathvariant=normal >≔</mi></mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi><munder><mo><mrow><mi mathvariant=normal >a</mi><mi mathvariant=normal >r</mi><mi mathvariant=normal >g</mi><mi mathvariant=normal >m</mi><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi></mrow><mtext> </mtext></mo><mi mathvariant=bold >z</mi></munder></mi><mtext> </mtext><mi>λ</mi><mo stretchy=false >∥</mo><mi mathvariant=bold >z</mi><msub><mo stretchy=false >∥</mo><mn>1</mn></msub><mo>+</mo><mo stretchy=false >(</mo><mi>ρ</mi><mi mathvariant=normal >/</mi><mn>2</mn><mo stretchy=false >)</mo><mo stretchy=false >∥</mo><mi mathvariant=bold >D</mi><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><mi mathvariant=bold >z</mi><mo>+</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><msubsup><mo stretchy=false >∥</mo><mn>2</mn><mn>2</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >=</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mrow><mi mathvariant=normal >S</mi><mi mathvariant=normal >T</mi></mrow><mrow><mo fence=true >(</mo><mi mathvariant=bold >D</mi><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>+</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo separator=true >,</mo><mtext> </mtext><mi>λ</mi><mi mathvariant=normal >/</mi><mi>ρ</mi><mo fence=true >)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{rcl} \mathbf{z}^{k+1} &amp;\coloneqq&amp; \underset{\mathbf{z}}{\mathrm{argmin}\,}\, \lambda\lVert \mathbf{z} \rVert_1 + (\rho/2)\lVert \mathbf{D}\mathbf{x}^{k+1} - \mathbf{z} + \mathbf{u}^k \rVert_2^2 \\ &amp;=&amp; \mathrm{ST}\left(\mathbf{D}\mathbf{x}^{k+1} + \mathbf{u}^k,\, \lambda/\rho \right) \end{array}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.9535480000000005em;vertical-align:-1.2267740000000003em;"></span><span class=mord ><span class=mtable ><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7267740000000003em;"><span style="top:-3.877666em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.1332259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2267740000000003em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7267740000000003em;"><span style="top:-3.877666em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel ><span class=mrel ><span class=mop  style="position:relative;top:-0.03472em;">:</span></span><span class=mrel ><span class=mspace  style="margin-right:-0.06666666666666667em;"></span></span><span class=mrel >=</span></span></span></span><span style="top:-2.1332259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel >=</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2267740000000003em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7267740000000003em;"><span style="top:-3.877666em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.66786em;"><span style="top:-2.20556em;margin-left:0em;"><span class=pstrut  style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">z</span></span></span></span><span style="top:-3em;"><span class=pstrut  style="height:3em;"></span><span><span class=mop ><span class=mord ><span class="mord mathrm">argmin</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.89444em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">λ</span><span class=mopen >∥</span><span class="mord mathbf">z</span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class="mord mathnormal">ρ</span><span class=mord >/2</span><span class=mclose >)</span><span class=mopen >∥</span><span class="mord mathbf">D</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">z</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∥</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.1332259999999996em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathrm">ST</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord mathbf">D</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">λ</span><span class=mord >/</span><span class="mord mathnormal">ρ</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.2267740000000003em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span></span></span></span></span></span></span> <p>Lastly, we have the scaled dual ascent, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant=bold >u</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo>+</mo><mi mathvariant=bold >D</mi><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>−</mo><msup><mi mathvariant=bold >z</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbf{u}^{k+1} = \mathbf{u}^k + \mathbf{D}\mathbf{x}^{k+1} - \mathbf{z}^{k+1}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8491079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.932438em;vertical-align:-0.08333em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.9324379999999999em;vertical-align:-0.08333em;"></span><span class="mord mathbf">D</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8491079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>.</p> <p>In the case of 2D signals &#40;i.e. an image&#41;, a simple option for an approximation to the gradient would be a finite difference scheme in both <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> directions<sup id="fnref:3"><a href="#fndef:3" class=fnref >[2]</a></sup>,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi mathvariant=bold >D</mi><mi mathvariant=bold >x</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub><mi mathvariant=bold >x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub><mi mathvariant=bold >x</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >d</mi><mi>x</mi></msub><mo>∗</mo><mi mathvariant=bold >x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >d</mi><mi>y</mi></msub><mo>∗</mo><mi mathvariant=bold >x</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo separator=true >,</mo><mspace width=1em /><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo stretchy=false >(</mo><msub><mi mathvariant=bold >d</mi><mi>x</mi></msub><mi mathvariant=bold >x</mi><mo stretchy=false >)</mo><mo stretchy=false >[</mo><mi>i</mi><mo separator=true >,</mo><mi>j</mi><mo stretchy=false >]</mo><mo>=</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo separator=true >,</mo><mi>j</mi><mo stretchy=false >]</mo><mo>−</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo separator=true >,</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy=false >]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo stretchy=false >(</mo><msub><mi mathvariant=bold >d</mi><mi>y</mi></msub><mi mathvariant=bold >x</mi><mo stretchy=false >)</mo><mo stretchy=false >[</mo><mi>i</mi><mo separator=true >,</mo><mi>j</mi><mo stretchy=false >]</mo><mo>=</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo separator=true >,</mo><mi>j</mi><mo stretchy=false >]</mo><mo>−</mo><mi mathvariant=bold >x</mi><mo stretchy=false >[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo separator=true >,</mo><mi>j</mi><mo stretchy=false >]</mo></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex"> \mathbf{D}\mathbf{x} = \begin{bmatrix} \mathbf{D}_x\mathbf{x} \\ \mathbf{D}_y\mathbf{x} \end{bmatrix} = \begin{bmatrix} \mathbf{d}_x \ast \mathbf{x} \\ \mathbf{d}_y \ast \mathbf{x} \end{bmatrix}, \quad \begin{matrix} (\mathbf{d}_x \mathbf{x})[i,j] = \mathbf{x}[i,j] - \mathbf{x}[i,j-1] \\ (\mathbf{d}_y \mathbf{x})[i,j] = \mathbf{x}[i,j] - \mathbf{x}[i-1,j] \end{matrix} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">Dx</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathbf">x</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathbf">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">x</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >∗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathbf">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class=mclose >)</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >1</span><span class=mclose >]</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >(</span><span class=mord ><span class="mord mathbf">d</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class=mclose >)</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathbf">x</span><span class=mopen >[</span><span class="mord mathnormal">i</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class=mclose >]</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Our <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>-update can still be computed in the Fourier domain via diagonalizing <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mi mathvariant=bold >D</mi></mrow><annotation encoding="application/x-tex">\mathbf{D}^\top\mathbf{D}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.849108em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord mathbf">D</span></span></span></span>,</p> <a id=eqtv_eigen_gram  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.1600em  columnalign="right center left" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mi mathvariant=bold >D</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >=</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msubsup><mi mathvariant=bold >D</mi><mi>x</mi><mi mathvariant=normal >⊤</mi></msubsup><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub><mo>+</mo><msubsup><mi mathvariant=bold >D</mi><mi>y</mi><mi mathvariant=normal >⊤</mi></msubsup><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mo lspace=0em  rspace=0em >=</mo></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msup><mi mathvariant=script >F</mi><mi mathvariant=normal >H</mi></msup><mo stretchy=false >(</mo><mo stretchy=false >∣</mo><msub><mi mathvariant=normal >Λ</mi><mi>x</mi></msub><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=false >∣</mo><msub><mi mathvariant=normal >Λ</mi><mi>y</mi></msub><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><mo stretchy=false >)</mo><mi mathvariant=script >F</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{rcl} \mathbf{D}^\top\mathbf{D} &amp;=&amp; \mathbf{D}_x^\top\mathbf{D}_x + \mathbf{D}_y^\top \mathbf{D}_y\\ &amp;=&amp;\mathcal{F}^\mathrm{H} (\lvert \Lambda_x \rvert^2 + \lvert \Lambda_y \rvert^2 ) \mathcal{F} \end{array}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.433547em;vertical-align:-0.9667735em;"></span><span class=mord ><span class=mtable ><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4667735em;"><span style="top:-3.6176655em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord mathbf">D</span></span></span><span style="top:-2.3932265em;"><span class=pstrut  style="height:3em;"></span><span class=mord ></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9667735em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4667735em;"><span style="top:-3.6176655em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel >=</span></span></span><span style="top:-2.3932265em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mrel >=</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9667735em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4667735em;"><span style="top:-3.6176655em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.3932265em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">H</span></span></span></span></span></span></span></span><span class=mopen >(∣</span><span class=mord ><span class=mord >Λ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >∣</span><span class=mord ><span class=mord >Λ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9667735em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span></span></span></span></span></span></span> <p>to yeild the update,</p> <a id=eqtv_fourier_xupdate  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msup><mi mathvariant=bold >x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mi mathvariant=script >F</mi><mi mathvariant=normal >H</mi></msup><mo stretchy=false >(</mo><mi>I</mi><mo>+</mo><mi>ρ</mi><mo stretchy=false >(</mo><mo stretchy=false >∣</mo><msub><mi mathvariant=normal >Λ</mi><mi>x</mi></msub><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><mo>+</mo><mo stretchy=false >∣</mo><msub><mi mathvariant=normal >Λ</mi><mi>y</mi></msub><msup><mo stretchy=false >∣</mo><mn>2</mn></msup><mo stretchy=false >)</mo><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi mathvariant=script >F</mi><mo stretchy=false >(</mo><mi mathvariant=bold >y</mi><mo>+</mo><mi>ρ</mi><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mo stretchy=false >(</mo><msup><mi mathvariant=bold >z</mi><mi>k</mi></msup><mo>−</mo><msup><mi mathvariant=bold >u</mi><mi>k</mi></msup><mo stretchy=false >)</mo><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex"> \mathbf{x}^{k+1} = \mathcal{F}^\mathrm{H} (I + \rho (\lvert \Lambda_x \rvert^2 + \lvert \Lambda_y \rvert^2))^{-1}\mathcal{F}(\mathbf{y} + \rho\mathbf{D}^\top(\mathbf{z}^k - \mathbf{u}^k)) </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8991079999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.1413309999999999em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">H</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class=mopen >(∣</span><span class=mord ><span class=mord >Λ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.150216em;vertical-align:-0.286108em;"></span><span class=mopen >∣</span><span class=mord ><span class=mord >Λ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose ><span class=mclose >∣</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mclose >)</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathcal" style="margin-right:0.09931em;">F</span><span class=mopen >(</span><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.149108em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ρ</span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathbf">z</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.149108em;vertical-align:-0.25em;"></span><span class=mord ><span class="mord mathbf">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class=mclose >))</span></span></span></span></span> <p>We can further extend this to RGB images &#40;or any other multi-feature image&#41; by separately taking <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> derivatives in each channel. For <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >x</mi><mo>=</mo><mo stretchy=false >[</mo><msub><mi mathvariant=bold >x</mi><mi>R</mi></msub><mo separator=true >;</mo><msub><mi mathvariant=bold >x</mi><mi>G</mi></msub><mo separator=true >;</mo><msub><mi mathvariant=bold >x</mi><mi>B</mi></msub><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">\mathbf{x} =[\mathbf{x}_R ; \mathbf{x}_G ; \mathbf{x}_B]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.44444em;vertical-align:0em;"></span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >;</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span></span></span></span>,</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi mathvariant=bold >D</mi><mn>3</mn></msub><mi mathvariant=bold >x</mi><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub><msub><mi mathvariant=bold >x</mi><mi>R</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub><msub><mi mathvariant=bold >x</mi><mi>R</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub><msub><mi mathvariant=bold >x</mi><mi>G</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub><msub><mi mathvariant=bold >x</mi><mi>G</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub><msub><mi mathvariant=bold >x</mi><mi>B</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub><msub><mi mathvariant=bold >x</mi><mi>B</mi></msub></mrow></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo>=</mo><mo fence=false  stretchy=true  minsize=1.8em  maxsize=1.8em >(</mo><msub><mi>I</mi><mn>3</mn></msub><mo>⊗</mo><munder><munder><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi mathvariant=bold >D</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><msub><mi mathvariant=bold >D</mi><mi>y</mi></msub></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mo stretchy=true >undefined</mo></munder><mi mathvariant=bold >D</mi></munder><mo fence=false  stretchy=true  minsize=1.8em  maxsize=1.8em >)</mo><mi mathvariant=bold >x</mi></mrow><annotation encoding="application/x-tex"> \mathbf{D}_3\mathbf{x} = \begin{bmatrix} \mathbf{D}_x \mathbf{x}_R \\ \mathbf{D}_y \mathbf{x}_R \\ \mathbf{D}_x \mathbf{x}_G \\ \mathbf{D}_y \mathbf{x}_G \\ \mathbf{D}_x \mathbf{x}_B \\ \mathbf{D}_y \mathbf{x}_B \end{bmatrix} = \Big( I_3 \otimes \underbrace{\begin{bmatrix} \mathbf{D}_x &amp; 0 \\ 0 &amp; \mathbf{D}_y \end{bmatrix}}_{\mathbf{D}} \Big) \mathbf{x} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83611em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:7.200099999999999em;vertical-align:-3.3500499999999995em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.8500499999999995em;"><span style="top:-2.91103em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-4.05803em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span style="height:3.616059999999999em;width:0.667em;"><svg width='0.667em' height='3.616059999999999em' style='width:0.667em' viewBox='0 0 667 3616' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V3616 H319z M319 0 H403 V3616 H319z'/></svg></span></span><span style="top:-8.31111em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3500499999999995em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.850000000000001em;"><span style="top:-6.010000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.810000000000001em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.6100000000000003em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">G</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2100000000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.009999999999999953em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">x</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.35em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.8500499999999995em;"><span style="top:-2.91103em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-4.05803em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span style="height:3.616059999999999em;width:0.667em;"><svg width='0.667em' height='3.616059999999999em' style='width:0.667em' viewBox='0 0 667 3616' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V3616 H263z M263 0 H347 V3616 H263z'/></svg></span></span><span style="top:-8.31111em;"><span class=pstrut  style="height:5.616059999999999em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3500499999999995em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.80002em;vertical-align:-0.65002em;"></span><span class=mord ><span class="delimsizing size2">(</span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:3.728307em;vertical-align:-2.278307em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4500000000000004em;"><span style="top:-1.1716930000000003em;"><span class=pstrut  style="height:3.45em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">D</span></span></span></span><span style="top:-3.45em;"><span class=pstrut  style="height:3.45em;"></span><span class="mord munder"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4500000000000002em;"><span class=svg-align  style="top:-1.8519700000000001em;"><span class=pstrut  style="height:3.45em;"></span><span class=stretchy  style="height:0.548em;min-width:1.6em;"><span class=brace-left  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMinYMin slice'><path d='M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7 -331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z'/></svg></span><span class=brace-center  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMidYMin slice'><path d='M199572 214 c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0 -5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z'/></svg></span><span class=brace-right  style="height:0.548em;"><svg width='400em' height='0.548em' viewBox='0 0 400000 548' preserveAspectRatio='xMaxYMin slice'><path d='M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237 -174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z'/></svg></span></span></span><span style="top:-3.45em;"><span class=pstrut  style="height:3.45em;"></span><span class=mord ><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.59803em;"><span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:2.278307em;"><span></span></span></span></span></span><span class=mord ><span class="delimsizing size2">)</span></span><span class="mord mathbf">x</span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊗</mo></mrow><annotation encoding="application/x-tex">\otimes</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.66666em;vertical-align:-0.08333em;"></span><span class=mord >⊗</span></span></span></span> is the Kronecker product. By the nature of Kronecker products, transposition is distributive and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>A</mi><mo>⊗</mo><mi>B</mi><mo stretchy=false >)</mo><mo stretchy=false >(</mo><mi>C</mi><mo>⊗</mo><mi>D</mi><mo stretchy=false >)</mo><mo>=</mo><mi>A</mi><mi>C</mi><mo>⊗</mo><mi>B</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">(A \otimes B)(C \otimes D) = AC\otimes BD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mclose >)</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>. Therefore, </p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msubsup><mi mathvariant=bold >D</mi><mn>3</mn><mi mathvariant=normal >⊤</mi></msubsup><msub><mi mathvariant=bold >D</mi><mn>3</mn></msub><mo>=</mo><msub><mi>I</mi><mn>3</mn></msub><mo>⊗</mo><msup><mi mathvariant=bold >D</mi><mi mathvariant=normal >⊤</mi></msup><mi mathvariant=bold >D</mi><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \mathbf{D}_3^\top\mathbf{D}_3 = I_3 \otimes \mathbf{D}^\top\mathbf{D}, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.146108em;vertical-align:-0.247em;"></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8991079999999998em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.093548em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathbf">D</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class="mord mathbf">D</span><span class=mpunct >,</span></span></span></span></span> <p>and our x-update involves dividing by Fourier domain factor <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> &#40;in <span class=eqref >(<a href="#eqtv_fourier_xupdate">8</a>)</span>&#41; channel-wise.</p> <h2 id=julia_implementation ><a href="#julia_implementation" class=header-anchor >Julia Implementation</a></h2> <p>I&#39;ve implemented a TV image denoising package, <a href="https://github.com/nikopj/TVDenoise.jl">TVDenoise.jl</a>. Below I walk through the source code in more detail and how I&#39;ve learned to program in Julia.</p> <h3 id=julia_workflow ><a href="#julia_workflow" class=header-anchor >Julia Workflow</a></h3> <p>Julia is most easily interfaced with via the <a href="https://docs.julialang.org/en/v1/stdlib/REPL/">REPL</a> &#40;read-eval-print-loop&#41;. There are 5 modes: Julian &#40;default&#41;, Shell &#40;<code>;</code>&#41;, Help &#40;<code>?</code>&#41;, Package &#40;<code>&#93;</code>&#41;, Search &#40;<code>^r</code>/<code>^s</code>&#41;. This is pretty similar to Matlab except you can&#39;t clear your workspace variables.</p> <h4 id=packages ><a href="#packages" class=header-anchor >Packages</a></h4> <ul> <li><p><a href="https://github.com/FluxML/NNlib.jl">NNlib</a>: from the <a href="https://fluxml.ai/Flux.jl/stable/">Flux</a> machine/deep learning library for our convolutions. Flux follows the convention of placing channel and batch dimension last, i.e. <code>&#40;H,W,C,B&#41;</code>. Unfortunately, right now it doesn&#39;t have a circular padding function.</p> <li><p><a href="https://github.com/JuliaMath/FFTW.jl">FFTW</a>: Fastest Fourier Transform in the West, conforming to Julia&#39;s <a href="https://juliamath.github.io/AbstractFFTs.jl/stable/api/#Public-Interface-1">AbstractFFT.jl API</a>.</p> <li><p><a href="https://docs.julialang.org/en/v1/stdlib/SparseArrays/">SparseArrays</a> for sparse linear system solving.</p> <li><p><a href="https://docs.julialang.org/en/v1/stdlib/Printf/">Printf</a> gives the <code>@printf</code> macro for C-like printing.</p> </ul> <p>Package <code>pkg</code> can be installed via <code>&#93; add pkg</code> in the REPL. You can start using package <code>pkg</code> in two different ways:</p> <ul> <li><p><code>import pkg</code>: Allows you to call functions defined in <code>pkg</code> via <code>pkg.function&#40;&#41;</code>.</p> <li><p><code>using pkg</code>: Same as <code>import pkg</code> but also brings a few specific functions specified by the package into the default namespace.</p> </ul> <h4 id=workflow ><a href="#workflow" class=header-anchor >Workflow</a></h4> <ul> <li><p><strong>Quick scripting</strong>: You can run scripts as executables with the shebang <code>#&#33;/usr/bin/env julia</code>, however keeping the REPL open means you don&#39;t have to recompile packges everytime you run the script. Run your script in the REPL via <code>include&#40;&quot;/path/to/script.jl&quot;&#41;</code>.</p> <li><p><strong>Projects</strong>: I followed the <a href="https://tlienart.github.io/pub/julia/dev-pkg.html">guide by Thibaut Leinart</a> for creating a package. This allows you to have your main functions included via <code>Using TVDenoise</code> in a separate testing code &#40;<code>test/example.jl</code>&#41;. <a href="https://timholy.github.io/Revise.jl/stable/">Revise.jl</a> allows the Julia REPL to track our project as we write to it, so that code updates to your codebase are taken into account without re-including the code or restarting the REPL. I recommend <a href="https://timholy.github.io/Revise.jl/stable/config/">including Revise in your <code>startup.jl</code></a>.</p> </ul> <h3 id=the_sparse_way ><a href="#the_sparse_way" class=header-anchor >The Sparse Way</a></h3> <p>We can write scalar soft-thresholding function in one line:</p> <pre><code class=language-julia >ST&#40;x,τ&#41; &#61; sign&#40;x&#41;*max&#40;abs&#40;x&#41;-τ, 0&#41;
ST&#40;1,0.5&#41;</code></pre> <pre><code class=plaintext >0.5</code></pre>
<p>To apply <code>ST</code> &#40;or any scalar function&#41; element-wise we use dot-syntax &#40;and <code>&#39;</code> to turn the resulting column-vector into a row-vector for display purposes&#41;,</p>
<pre><code class=language-julia >x &#61; -1:0.2:1
y &#61; ST.&#40;x,0.2&#41;&#39;</code></pre>
<pre><code class=plaintext >1×11 adjoint(::Vector{Float64}) with eltype Float64:
 -0.8  -0.6  -0.4  -0.2  -0.0  0.0  0.0  0.2  0.4  0.6  0.8</code></pre>
<div class=box-red ><div class=title ><strong>⚠Warning⚠</strong>:</div>
<div class=content ><strong>All variables are passed by reference</strong>, not value – if you augment a variable inside a function it will change outside of it too. Functions that mutate their inputs are post-fixed by <code>&#33;</code> by convention, ex. <code>push&#33;&#40;v&#41;</code>.</div></div>
<p>We can always implement the ADMM described above directly with <strong>sparse linear solves</strong>. First, we need to generate the sparse first-order derivative matrix. </p>
<pre><code class=language-julia >function FDmat&#40;N::Int&#41;::SparseMatrixCSC
	spdiagm&#40;0 &#61;&gt; -1*ones&#40;N&#41;, 1 &#61;&gt; ones&#40;N&#41;&#41;&#91;1:N-1,1:N&#93;;
end</code></pre>
<p>Here we specify the input as an integer and output as a <code>SparseMatrixCSC</code>. By default, Julia functions return the return of their last statement. Therefore, the return keyword is not needed in this function definition &#40;though it could be used&#41;. <code>FDmat&#40;N&#41;</code> returns <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mo>∈</mo><msup><mi mathvariant=double-struck >R</mi><mrow><mi>N</mi><mo>−</mo><mn>1</mn><mo>×</mo><mi>N</mi></mrow></msup></mrow><annotation encoding="application/x-tex">D \in \mathbb R^{N-1\times N}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbb">R</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span> and imposes no boundary conditions. </p>
<p>The 2D TV operator is formed by stacking the horizontal and vertical first-order derivative matrices on top of each other. These operators need to act on the vectorized image. Using the fact that <strong>Julia stores matrices column-major</strong>, you should be able to understand why our 2D and 3D functions are implemented as follows,</p>
<pre><code class=language-julia >function FDmat&#40;M::Int, N::Int&#41;::SparseMatrixCSC
	# vertical derivative
	S &#61; spdiagm&#40;N-1, N, ones&#40;N-1&#41;&#41;;
	T &#61; FDmat&#40;M&#41;;
	Dy &#61; kron&#40;S,T&#41;;
	# horizontal derivative
	S &#61; FDmat&#40;N&#41;;
	T &#61; spdiagm&#40;M-1, M, ones&#40;M-1&#41;&#41;;
	Dx &#61; kron&#40;S,T&#41;;
	return &#91;Dx; Dy&#93;;
end

function FDmat&#40;M::Int, N::Int, C::Int&#41;::SparseMatrixCSC
	kron&#40;I&#40;C&#41;,FDmat&#40;M,N&#41;&#41;
end</code></pre>
<p>This definition of <code>FDmat&#40;&#41;</code> shows off Julia&#39;s &quot;multiple dispatch&quot;, which is basically function overloading. </p>
<div class=box-green ><div class=title ><strong>Note</strong>:</div>
<div class=content >Type decorating of function arguments is really only necessary for multiple dispatching, and doesn&#39;t affect performance.</div></div>
<p>With this, we can implement the ADMM TVD solver <code>tvd&#40;&#41;</code>,</p>
<pre><code class=language-julia >function tvd&#40;y::AbstractVector, D::AbstractMatrix, λ, ρ, maxit, tol, verbose&#41;
	M, N &#61; size&#40;D&#41;;
	objfun&#40;x,Dx&#41; &#61; 0.5*sum&#40;&#40;x-y&#41;.^2&#41; &#43; λ*norm&#40;Dx, 1&#41;;
	x &#61; y;
	z &#61; zeros&#40;M&#41;;
	u &#61; zeros&#40;M&#41;;
	F &#61; zeros&#40;maxit&#41;; # objective fun,
	r &#61; zeros&#40;maxit&#41;; # primal residual
	s &#61; zeros&#40;maxit&#41;; # dual residual

	C &#61; cholesky&#40;I &#43; ρ*D&#39;*D&#41;;

	k &#61; 0; 
	while k &#61;&#61; 0 || k &lt; maxit &amp;&amp; r&#91;k&#93; &gt; tol
		x &#61; C\&#40;y &#43; ρ*D&#39;*&#40;z - u&#41;&#41;; # x-update
		Dx &#61; D*x;
		zᵏ &#61; z;
		z &#61; ST.&#40;Dx &#43; u, λ/ρ&#41;;     # z-update
		u &#61; u &#43; Dx - z;           # dual ascent
		r&#91;k&#43;1&#93; &#61; norm&#40;Dx - z&#41;;
		s&#91;k&#43;1&#93; &#61; ρ*norm&#40;D&#39;*&#40;z - zᵏ&#41;&#41;;
		F&#91;k&#43;1&#93; &#61; objfun&#40;x,Dx&#41;;
		k &#43;&#61; 1;
		if verbose
			@printf &quot;k: &#37;3d | F&#61; &#37;.3e | r&#61; &#37;.3e | s&#61; &#37;.3e \n&quot; k F&#91;k&#93; r&#91;k&#93; s&#91;k&#93; ;
		end
	end
	return x, &#40;k&#61;k, obj&#61;F&#91;1:k&#93;, pres&#61;r&#91;1:k&#93;, dres&#61;s&#91;1:k&#93;&#41;
end</code></pre>
<p>In <code>tvd&#40;&#41;</code> we precompute our Cholesky factor to have fast <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> updates. <code>C</code> is a special object ready for solving linear systems via backslash <code>\</code>.  As the above <code>tvd&#40;&#41;</code> is defined only for vector inputs, we can overload to define a <code>tvd&#40;&#41;</code> function for 2D and 3D inputs.</p>
<pre><code class=language-julia >function tvd&#40;y::AbstractArray, λ, ρ&#61;1; maxit&#61;100, tol&#61;1e-6, verbose&#61;true&#41;
	sz &#61; size&#40;y&#41;;
	D &#61; FDmat&#40;sz...&#41;;
	x, hist &#61; tvd&#40;vec&#40;y&#41;, D, λ, ρ, maxit, tol, verbose&#41;;
	return reshape&#40;x, sz...&#41;, hist
end</code></pre>
<p>This has turned out so clean because we&#39;ve already overloaded <code>FDmat&#40;&#41;</code> to return the correct TV operators. Note that the &quot;splat&quot; operator &#40;<code>...</code>&#41; unpacks tuples and more &#40;see <code>? ...</code>&#41;. </p>
<h3 id=the_fast_fourier_transform_way ><a href="#the_fast_fourier_transform_way" class=header-anchor >The Fast &#40;Fourier Transform&#41; Way</a></h3>
<p>The assumption of periodicity allows us to diagonalize our linear system in the Fourier domain and solve much faster. We first need to create our own circular convolution function, as circular padding isn&#39;t implemented in NNlib.jl.</p>
<a id=pad_circular  class=anchor ></a>
<pre><code class=language-julia >function pad_circular&#40;A::Array&#123;&lt;:Number,4&#125;, pad::NTuple&#123;4,Int&#125;&#41;
	M, N &#61; size&#40;A&#41;&#91;1:2&#93;
	if any&#40;pad .&gt; M&#41; || any&#40;pad .&gt; N&#41;
		error&#40;&quot;padding larger than original matrix&#33;&quot;&#41;
	end
	# allocate array
	B &#61; pad_constant&#40;A, pad, dims&#61;&#40;1,2&#41;&#41;
	t, b, l, r &#61; pad
	f&#40;p,L&#41; &#61; L-p&#43;1:L
	# top-left lorner
	B&#91;1:t, 1:l, :, :&#93;               &#61; A&#91;f&#40;t,M&#41;, f&#40;l,N&#41;, :, :&#93;
	# top-middle
	B&#91;1:t, l&#43;1:l&#43;N, :, :&#93;           &#61; A&#91;f&#40;t,M&#41;, :, :, :&#93;
	# top-right
	B&#91;1:t, f&#40;r,N&#43;l&#43;r&#41;, :, :&#93;        &#61; A&#91;f&#40;t,M&#41;, 1:r, :, :&#93;
	# left-middle
	B&#91;t&#43;1:t&#43;M, 1:l, :, :&#93;           &#61; A&#91;:, f&#40;l,N&#41;, :, :&#93;
	# right-middle
	B&#91;t&#43;1:t&#43;M, f&#40;r,N&#43;l&#43;r&#41;, :, :&#93;    &#61; A&#91;:, 1:r, :, :&#93;
	# bottom-left
	B&#91;f&#40;b,M&#43;b&#43;t&#41;, 1:l, :, :&#93;        &#61; A&#91;1:b, f&#40;l,N&#41;, :, :&#93;
	# bottom-middle
	B&#91;f&#40;b,M&#43;t&#43;b&#41;, l&#43;1:l&#43;N, :, :&#93;    &#61; A&#91;1:b, :, :, :&#93;
	# bottom-right
	B&#91;f&#40;b,M&#43;t&#43;b&#41;, f&#40;r,N&#43;l&#43;r&#41;, :, :&#93; &#61; A&#91;1:b, 1:r, :, :&#93;
	return B
end</code></pre>
<p>The definition of <code>pad_circular&#40;&#41;</code> gives an example of how to discriminate Array inputs  based on the number of dimension. The crucial part is defining the element-type to allow any subtype of <code>Number</code> via the subtype operator <code>&lt;:</code>. Also note that <code>NTuple&#123;4,Int&#125;</code> is short for <code>Tuple&#123;Int,Int,Int,Int&#125;</code>. A good way to check if your arguments are labeled as desired is using <code>isa&#40;&#41;</code>,</p>
<pre><code class=language-julia >A &#61; reshape&#40;collect&#40;1:9&#41;, 3,3&#41;;
println&#40;isa&#40;A, Array&#123;Number, 2&#125;&#41;&#41;
isa&#40;A, Array&#123;&lt;:Number, 2&#125;&#41;</code></pre>
<pre><code class=plaintext >false
true</code></pre>
<p>Use <code>typeof&#40;&#41;</code> and <code>eltype&#40;&#41;</code> to get the type of an array and its elements respectively.</p>
<p>We now can write the ADMM Fourier domain solver.</p>
<pre><code class=language-julia >function tvd_fft&#40;y::Array&#123;&lt;:Real,4&#125;, λ, ρ&#61;1; maxit&#61;100, tol&#61;1e-6, verbose&#61;true&#41;
	M, N, P &#61; size&#40;y&#41;&#91;1:3&#93;
	# move channels to batch dimension
	y &#61; permutedims&#40;y, &#40;1,2,4,3&#41;&#41;
	τ &#61; λ/ρ;

	# precompute C for x-update
	Λx &#61; rfft&#40;&#91;1 -1 zeros&#40;N-2&#41;&#39;; zeros&#40;M-1,N&#41;&#93;&#41;;
	Λy &#61; rfft&#40;&#91;&#91;1; -1; zeros&#40;M-2&#41;&#93; zeros&#40;M,N-1&#41;&#93;&#41;
	C &#61; 1 ./ &#40; 1 .&#43; ρ.*&#40;abs2.&#40;Λx&#41; .&#43; abs2.&#40;Λy&#41;&#41; &#41;;

	# real Fourier xfrm in image dimension.
	# Must specify length of first dimension for inverse.
	Q  &#61; plan_rfft&#40;y,&#40;1,2&#41;&#41;;
	Qᴴ &#61; plan_irfft&#40;rfft&#40;y&#41;,M,&#40;1,2&#41;&#41;;

    # conv kernel
	W &#61; Float64.&#40;zeros&#40;2,2,1,2&#41;&#41;;
	W&#91;:,:,1,1&#93; &#61; &#91;1 -1; 0 0&#93;;          # dx
	W&#91;:,:,1,2&#93; &#61; &#91;1  0;-1 0&#93;;          # dy
	Wᵀ &#61; reverse&#40;permutedims&#40;W, &#40;2,1,4,3&#41;&#41;, dims&#61;:&#41;;

	# Circular convolution
	D&#40;x&#41; &#61; conv&#40;pad_circular&#40;x, &#40;1,0,1,0&#41;&#41;, W&#41;;
	Dᵀ&#40;x&#41;&#61; conv&#40;pad_circular&#40;x, &#40;0,1,0,1&#41;&#41;, Wᵀ&#41;;

	objfun&#40;x,Dx&#41; &#61; 0.5*sum&#40;abs2.&#40;x-y&#41;&#41; &#43; λ*norm&#40;Dx, 1&#41;;

	# initialization
	z &#61; zeros&#40;M,N,2,P&#41;;
	u &#61; zeros&#40;M,N,2,P&#41;;
	F &#61; zeros&#40;maxit&#41;; # store objective fun
	r &#61; zeros&#40;maxit&#41;; # store primal residual
	s &#61; zeros&#40;maxit&#41;; # store dual   residual

	k &#61; 0;
	while k &#61;&#61; 0 || k &lt; maxit &amp;&amp; r&#91;k&#93; &gt; tol &amp;&amp; s&#91;k&#93; &gt; tol
		x &#61; Qᴴ*&#40;C.*&#40;Q*&#40; y &#43; ρ*Dᵀ&#40;z-u&#41; &#41;&#41;&#41;; # x update
		Dxᵏ &#61; D&#40;x&#41;;
		zᵏ  &#61; z;
		z &#61; ST.&#40;Dxᵏ&#43;u, τ&#41;;                 # z update
		u &#61; u &#43; Dxᵏ - z;                   # dual ascent
		r&#91;k&#43;1&#93; &#61; norm&#40;Dxᵏ-z&#41;;
		s&#91;k&#43;1&#93; &#61; norm&#40;z-zᵏ&#41;;
		F&#91;k&#43;1&#93; &#61; objfun&#40;x,Dxᵏ&#41;;
		k &#43;&#61; 1;
		if verbose
			@printf &quot;k: &#37;3d | F&#61; &#37;.3e | r&#61; &#37;.3e | s&#61; &#37;.3e \n&quot; k F&#91;k&#93; r&#91;k&#93; s&#91;k&#93;;
		end
	end
	x &#61; permutedims&#40;x, &#40;1,2,4,3&#41;&#41;;
	return x, &#40;k&#61;k, obj&#61;F&#91;1:k&#93;, pres&#61;r&#91;1:k&#93;, dres&#61;s&#91;1:k&#93;&#41;
end</code></pre>
<p>Circular convolution is implemented by our <a href="#pad_circular">circular padding</a> followed by NNlib&#39;s <code>conv</code>. </p>
<div class=box-green ><div class=title ><strong>Note</strong>: NNlib&#39;s convolution function</div>
<div class=content ><code>conv</code> implements <strong>valid convolution, not correlation</strong>. Correlation can be run instead by using the kwarg <code>flipped&#61;true</code>. The supplied kernel <code>W</code> is given by height, width, in-channels, and out-channels as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >[</mo><mi>H</mi><mo separator=true >,</mo><mi>W</mi><mo separator=true >,</mo><msub><mi>C</mi><mrow><mi mathvariant=normal >i</mi><mi mathvariant=normal >n</mi></mrow></msub><mo separator=true >,</mo><msub><mi>C</mi><mrow><mi mathvariant=normal >o</mi><mi mathvariant=normal >u</mi><mi mathvariant=normal >t</mi></mrow></msub><mo stretchy=false >]</mo></mrow><annotation encoding="application/x-tex">[H,W,C_{\mathrm{in}},C_{\mathrm{out}}]</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >[</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.31750199999999995em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">in</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">out</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >]</span></span></span></span>.  1D, 2D, 3D signals all use the same <code>conv</code> function. The expression for <code>Wᵀ</code> is especially insightful – filters must be spatially reversed and have their ordering reversed.</div></div>
<p>To perform <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span> gradient calculations in the same conv function we have to pay attention to padding. Our horizontal filter shouldn&#39;t touch our top padding and our vertical filter shouldn&#39;t touch the left padding. Therefore, by also taking into account that convolution is a flip and slide, we write the kernel <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>&#39;s two filters &#40;in output dimension&#41; as,</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>W</mi><mo stretchy=false >[</mo><mo>:</mo><mo separator=true >,</mo><mo>:</mo><mo separator=true >,</mo><mn>1</mn><mo separator=true >,</mo><mn>1</mn><mo stretchy=false >]</mo><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mspace width=1em /><mi>W</mi><mo stretchy=false >[</mo><mo>:</mo><mo separator=true >,</mo><mo>:</mo><mo separator=true >,</mo><mn>1</mn><mo separator=true >,</mo><mn>2</mn><mo stretchy=false >]</mo><mo>=</mo><mrow><mo fence=true >[</mo><mtable rowspacing=0.1600em  columnalign="center center" columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=false ><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true >]</mo></mrow><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex">
W[:,:,1,1] = \begin{bmatrix} 1 &amp; -1 \\ 0 &amp; 0 \end{bmatrix} \quad 
W[:,:,1,2] = \begin{bmatrix} 1 &amp;  0 \\-1 &amp; 0 \end{bmatrix}.
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mopen >[</span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:1em;"></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class=mopen >[</span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >2</span><span class=mclose >]</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >−</span><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:0.5em;"></span><span class=arraycolsep  style="width:0.5em;"></span><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.45em;"><span style="top:-3.61em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span><span style="top:-2.4099999999999997em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.9500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >.</span></span></span></span></span>
<p>To precompute our Fourier factor <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, we pad our filters to yeild the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>-dimensional transform domain representations. We can use <code>rfft</code> to exploit the conjugate symmetry of our real-valued filters and only compute half the coefficients.</p>
<p>Our last point of interest is the use of planned FFTs. These return operators that use matrix multiplication syntax, but are not performing dense matrix-vector multiplications. The benefit in doing so is that the butterfly network used to compute our FFT is saved in memory for faster computation. The first argument of each plan function above is meant to give the size and data-type of inputs we&#39;ll use in the loop.</p>
<h3 id=comparison ><a href="#comparison" class=header-anchor >Comparison</a></h3>
<p>A full demo code can be found in <a href="https://github.com/nikopj/TVDenoise.jl/blob/main/examples/example.jl">the repository</a>. Code shown below is <em>not</em> given in the repository.</p>
<p>We demonstrate our working TV denoising on the example Fabio image with AWGN, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mi>n</mi></msub><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">\sigma_n = 25</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >25</span></span></span></span> &#40;on a 0-255 scale&#41;.</p>

<figure style="text-align:center;">
<img src="/assets/tvd/exfabio.png" style="padding:0; width:100%" alt=" The two methods acheive similar PSNR results."/>
<figcaption> The two methods acheive similar PSNR results.</figcaption>
</figure>

<p>The similarity of results is to be expected because their solving almost exactly the same problem. Where we&#39;ll find gains is in our run times. </p>
<p>I ran some rudimentary timing tests on different versions of the Fabio image and hard-coded results in the visualization script below. The FFT version is seriously fast in comparison. </p>
<pre><code class=language-julia >using Plots, StatsPlots
t1 &#61; &#91;3.3, 14.2, 24.5, 101.0&#93; # tvd times
t2 &#61; &#91;0.5, 1.6,  2.8,  10.8&#93;  # tvd_fft times
name &#61; repeat&#40;&#91;&quot;Gray 256&quot;, &quot;Color 256&quot;, &quot;Gray 512&quot;, &quot;Color 512&quot;&#93;, outer&#61;2&#41;
group&#61; repeat&#40;&#91;&quot;Sparse&quot;, &quot;FFT&quot;&#93;, inner&#61;4&#41;
groupedbar&#40;name, &#91;t1;t2&#93;, group&#61;group&#41;
ylabel&#33;&#40;&quot;time &#40;s&#41;&quot;&#41;
savefig&#40;&quot;timebar.svg&quot;&#41;</code></pre>

<figure style="text-align:center;">
<img src="/assets/tvd/timebar.svg" style="padding:0; width:80%" alt=" FFT vs. sparse-array timing comparison."/>
<figcaption> FFT vs. sparse-array timing comparison.</figcaption>
</figure>

<p>As a last example, I&#39;ll demonstrate that TV denoising is not just a trick for synthetically generated noisy images. Below is a real noisy photo of Masa.</p>

<figure style="text-align:center;">
<img src="/assets/tvd/masa.png" style="padding:0; width:100%" alt=" "/>
<figcaption> </figcaption>
</figure>

<pre><code class=language-julia >using TVDenoise, FileIO
img &#61; load&#40;&quot;masa.png&quot;&#41;
x, _ &#61; tvd_fft&#40;img, 0.02, 5&#41;
save&#40;&quot;tvdmasa.png&quot;, x&#41;</code></pre>
<p>Our TV denoising is able to clean it up nicely. 
<figure style="text-align:center;">
<img src="/assets/tvd/tvdmasa.png" style="padding:0; width:100%" alt=" "/>
<figcaption> </figcaption>
</figure>
</p>
<p>One question that persists throughout this demos is, &quot;Is there a different set of filters that are better tailored to regularizing the denoising problem?&quot;. We can formulate our problem as also being a minimization over <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >D</mi></mrow><annotation encoding="application/x-tex">\mathbf{D}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">D</span></span></span></span>, known as the Analysis Convolutional Dictionary Learning problem. Special care has to be taken to ensure that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=bold >D</mi></mrow><annotation encoding="application/x-tex">\mathbf{D}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68611em;vertical-align:0em;"></span><span class="mord mathbf">D</span></span></span></span> is not degenerate. A Julia implementation for another post&#33;</p>
<table class=fndef  id="fndef:1">
    <tr>
        <td class=fndef-backref ><a href="#fnref:1">[1]</a>
        <td class=fndef-content >See <a href="/blog/understanding-ista/#derivation_of_the_proximal_operator_for_the_ell_1-norm"><em>Understanding ISTA as a Fixed-Point Iteration</em></a> for a derivation of soft-thresholding.
    
</table>

<div class=page-foot >
  <div class=copyright >
  <a href="https://github.com/nikopj">GitHub</a> <br>
    &copy; Nikola Janjušević. Last modified: 0001-01-01. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    
        



    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>